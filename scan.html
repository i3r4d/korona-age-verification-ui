<!DOCTYPE html>
<html>
<head>
    <title>KORONA API Test</title>
     <!-- Load KORONA script FIRST -->
     <script type="text/javascript" src="korona-plugin-api.js"></script>
     <script>
         // Try to access the API immediately after script load and on window load
         function checkApi() {
             console.log("Attempting API check...");
             try {
                 if (typeof korona_plugin_api !== 'undefined' && korona_plugin_api) {
                     console.log("KORONA API DETECTED!");
                     document.getElementById("status").textContent = "SUCCESS: KORONA API Found!";
                     document.getElementById("status").style.color = "green";

                     // Optional: Try calling ready
                     korona_plugin_api.ready(function() {
                         console.log("KORONA API Ready Callback Fired!");
                         document.getElementById("ready").textContent = "API Ready: Yes";
                         try {
                              // Log request data if possible
                              console.log("Request Data:", JSON.stringify(korona_plugin_api.request || {}));
                              document.getElementById("data").textContent = "Request Data: " + JSON.stringify(korona_plugin_api.request || { type: 'No data received' });
                         } catch(e) {
                              console.error("Error accessing request data:", e);
                              document.getElementById("data").textContent = "Error accessing request data.";
                         }
                     });

                 } else {
                     console.error("KORONA API *NOT* DETECTED.");
                     document.getElementById("status").textContent = "FAILURE: korona_plugin_api is not defined.";
                     document.getElementById("status").style.color = "red";
                 }
             } catch (e) {
                 console.error("Error during API check:", e);
                 document.getElementById("status").textContent = "ERROR during check: " + e.message;
                 document.getElementById("status").style.color = "red";
             }
         }

         // Run check on window load
         window.onload = checkApi;
         // Also run check slightly after load, just in case timing is weird
         setTimeout(checkApi, 500);

     </script>
</head>
<body>
    <h1>KORONA API Injection Test</h1>
    <p id="status">Checking for KORONA API...</p>
    <p id="ready">API Ready: No</p>
    <pre id="data" style="border:1px solid #ccc; padding: 5px; max-height: 200px; overflow: auto;">Request Data: Waiting...</pre>
     <button onclick="korona_plugin_api ? korona_plugin_api.backToKorona() : alert('KORONA API not found');">Test Back Button</button>
</body>
</html>
